on_actions = {
	on_startup = {
		#开局给玩家加所有角色
		
		effect = {
			ALI = {
				set_variable = {
					touhou_var_alice_doll_consumer_goods_expected_value = 0.1
				}
				set_variable = {
					#如果写进history里会导致“num_of_factories”为0
					touhou_var_alice_trait_manpower = num_of_factories
				}
				multiply_variable = {
					var = touhou_var_alice_trait_manpower
					value = 1065
				}
			}
			EVI = {
				if = {
					limit = {
						original_tag = EVI
						is_ai = yes
					}
					activate_mission = touhou_mission_ai_evi_military_academy_1
				}
			}
			every_country = {
				limit = {
					OR = {
						original_tag = ALI
						original_tag = DES
						original_tag = HAK
						original_tag = DLD
						original_tag = HEL
						original_tag = SSS
						original_tag = OPP
						original_tag = RAB
						original_tag = TEM
						original_tag = BLI
						original_tag = KAP
						original_tag = TEN
						original_tag = HUM
						original_tag = VAM
						original_tag = MLS
						original_tag = EVI
					}
				}
				
				country_event = {
					id = touhou_communication.2
					days = 5
					random_days = 1
				}
				every_character = {
					limit = {
						OR = {
							has_trait = communist_revolutionary
							has_trait = democratic_reformer
							has_trait = fascist_demagogue
							has_trait = head_of_intelligence
						}
					}
					retire = yes
				}
				every_owned_state = {
					set_state_flag = is_gensokyo_state_flag
				}
				add_ideas = touhou_no_need_help
				if = {
					limit = {
						is_ai = no
					}
					country_event = {
						id = touhou_difficulty_select.1
					}
				}
				every_character = {
					set_character_flag = touhou_character_flag_character
				}
			}
		}
	}
	on_puppet = {
		#傀儡，root是傀儡国，from是宗主国
		effect = {
			if = {
				#幻想乡国家傀儡幻想乡国家
				limit = {
					any_character = {
						has_character_flag = touhou_character_flag_character
					}
					FROM = {
						OR = {
							original_tag = ALI
							original_tag = DES
							original_tag = HAK
							original_tag = DLD
							original_tag = HEL
							original_tag = SSS
							original_tag = OPP
							original_tag = RAB
							original_tag = TEM
							original_tag = BLI
							original_tag = KAP
							original_tag = TEN
							original_tag = HUM
							original_tag = VAM
							original_tag = MLS
							original_tag = EVI
						}
					}
				}
				if = {
					limit = {
						NOT = {
							has_country_flag = touhou_country_flag_a_player_capture_character
						}
						FROM = {
							is_ai = no
						}
					}
					set_country_flag = touhou_country_flag_a_player_capture_character
					FROM = {
						country_event = {
							id = touhou_capture_character.11
						}
					}
				}
				else_if = {
					limit = {
						NOT = {
							has_country_flag = touhou_country_flag_a_ai_capture_character
						}
						FROM = {
							is_ai = yes
						}
					}
					set_country_flag = touhou_country_flag_a_ai_capture_character
					FROM = {
						country_event = {
							id = touhou_capture_character.12
						}
					}
				}
			}
			else_if = {
				#外界傀儡幻想乡国家
				limit = {
					any_character = {
						has_character_flag = touhou_character_flag_character
					}
					FROM = {
						NOT = {
							original_tag = ALI
							original_tag = DES
							original_tag = HAK
							original_tag = DLD
							original_tag = HEL
							original_tag = SSS
							original_tag = OPP
							original_tag = RAB
							original_tag = TEM
							original_tag = BLI
							original_tag = KAP
							original_tag = TEN
							original_tag = HUM
							original_tag = VAM
							original_tag = MLS
							original_tag = EVI
						}
					}
				}
				if = {
					limit = {
						NOT = {
							has_country_flag = touhou_country_flag_a_player_capture_character
						}
						any_country = {
							is_ai = no
							OR = {
								original_tag = ALI
								original_tag = DES
								original_tag = HAK
								original_tag = DLD
								original_tag = HEL
								original_tag = SSS
								original_tag = OPP
								original_tag = RAB
								original_tag = TEM
								original_tag = BLI
								original_tag = KAP
								original_tag = TEN
								original_tag = HUM
								original_tag = VAM
								original_tag = MLS
								original_tag = EVI
							}
						}
					}
					set_country_flag = touhou_country_flag_a_player_capture_character
					random_country = {
						limit = {
							is_ai = no
							OR = {
								original_tag = ALI
								original_tag = DES
								original_tag = HAK
								original_tag = DLD
								original_tag = HEL
								original_tag = SSS
								original_tag = OPP
								original_tag = RAB
								original_tag = TEM
								original_tag = BLI
								original_tag = KAP
								original_tag = TEN
								original_tag = HUM
								original_tag = VAM
								original_tag = MLS
								original_tag = EVI
							}
						}
						country_event = {
							id = touhou_capture_character.13
						}
					}
				}
				else_if = {
					limit = {
						NOT = {
							has_country_flag = touhou_country_flag_a_ai_capture_character
						}
						any_country = {
							is_ai = yes
							OR = {
								original_tag = ALI
								original_tag = DES
								original_tag = HAK
								original_tag = DLD
								original_tag = HEL
								original_tag = SSS
								original_tag = OPP
								original_tag = RAB
								original_tag = TEM
								original_tag = BLI
								original_tag = KAP
								original_tag = TEN
								original_tag = HUM
								original_tag = VAM
								original_tag = MLS
								original_tag = EVI
							}
						}
					}
					set_country_flag = touhou_country_flag_a_ai_capture_character
					random_country = {
						limit = {
							is_ai = yes
							OR = {
								original_tag = ALI
								original_tag = DES
								original_tag = HAK
								original_tag = DLD
								original_tag = HEL
								original_tag = SSS
								original_tag = OPP
								original_tag = RAB
								original_tag = TEM
								original_tag = BLI
								original_tag = KAP
								original_tag = TEN
								original_tag = HUM
								original_tag = VAM
								original_tag = MLS
								original_tag = EVI
							}
						}
						country_event = {
							id = touhou_capture_character.14
						}
					}
				}
			}
		}
	}
	on_peace = {
		effect = {
			this = {
				if = {
					limit = {
						has_global_flag = touhou_global_flag_our_world
						has_country_flag = touhou_god_of_makai_country_flag
					}
					TOUHOU_boss_shinki_leader = {
						remove_country_leader_role = {
							ideology = rexism
						}
						remove_country_leader_role = {
							ideology = nazism
						}
						remove_country_leader_role = {
							ideology = gen_nazism
						}
						remove_country_leader_role = {
							ideology = fascism_ideology
						}
						remove_country_leader_role = {
							ideology = falangism
						}
					}
					touhou_boss_shinki_commander_0 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_1 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_2 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_3 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_4 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_5 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_6 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_7 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_8 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_9 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_a = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_b = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_c = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_d = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_e = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_commander_f = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_navy_0 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_navy_1 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_navy_2 = {
						remove_unit_leader_role = yes
					}
					touhou_boss_shinki_navy_3 = {
						remove_unit_leader_role = yes
					}
					delete_unit_template_and_units = {
						division_template = "魔界先遣部队"
					}
					delete_unit_template_and_units = {
						division_template = "魔界两栖部队"
					}
					delete_unit_template_and_units = {
						division_template = "魔界主力部队"
					}
					delete_unit_template_and_units = {
						division_template = "魔界精英部队"
					}
					delete_unit_template_and_units = {
						division_template = "魔界突击部队"
					}
					add_offsite_building = {
						type = arms_factory
						level = -1035
					}
					add_offsite_building = {
						type = dockyard
						level = -1035
					}
					add_offsite_building = {
						type = industrial_complex
						level = -1035
					}
					set_cosmetic_tag = touhou_god_of_makai_has_left_cosmetic_tag
					set_politics = {
						ruling_party = neutrality
					}
					add_popularity = {
						ideology = neutrality
						popularity = 0.3
					}
					leave_faction = yes
					remove_ideas = {
						touhou_god_of_makai_ideas_General_last_stage
						touhou_god_of_makai_ideas_Equipment_last_stage
						touhou_god_of_makai_ideas_Military_last_stage
						touhou_god_of_makai_ideas_Land_combat_last_stage
						touhou_god_of_makai_ideas_Navy_and_Air_last_stage
						touhou_ideas_god_of_makai_other
					}
					# remove_mission = touhou_mission_god_of_makai_amry
					set_global_flag = touhou_god_of_makai_has_left_global_flag					#魔界已经离去flag
					clr_global_flag = touhou_global_flag_our_world
					clr_country_flag = touhou_god_of_makai_country_flag					#清除魔界国家flag
					every_other_country = {
						news_event = {
							id = nstouhou.62
						}
					}
				}
			}
		}
	}
	on_startup = {
		effect = {
			every_country = {
				if = {
					limit = {
						OR = {
							original_tag = ALI
							original_tag = DES
							original_tag = HAK
							original_tag = DLD
							original_tag = HEL
							original_tag = SSS
							original_tag = OPP
							original_tag = RAB
							original_tag = TEM
							original_tag = BLI
							original_tag = KAP
							original_tag = TEN
							original_tag = HUM
							original_tag = VAM
							original_tag = MLS
							original_tag = EVI
						}
						is_ai = no
					}
					country_event = {
						id = touhou_devildom.5
						days = 1802
					}
					set_global_flag = touhou_this_is_touhou_mod_identity_flag					#幻想世界入mod识别flag
				}
			}
		}
	}
}
